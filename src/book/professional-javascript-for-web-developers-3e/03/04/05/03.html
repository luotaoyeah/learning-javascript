<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>floating-point-values</title>

    <script>
      'use strict';

      (function () {
        // https://2ality.com/2012/04/number-encoding.html
        // https://github.com/senntyou/blogs/blob/master/javascript/2.md
        //
        // JS 使用 IEEE-754 标准的 64 位双精度浮点数(binary64 / double precision)来表示所有的数字,
        // 所有的数字(除了下面的特殊情况)都满足公式 (-1)^s * 1.f * 2^(e - 1023)
        //
        // 其中:
        //   s 表示符号, 占 1  位, 0 表示正数, 1 表示负数
        //   f 表示分数, 占 52 位,
        //   e 表示指数, 占 11 位,
        //
        // e 的取值范围为 [0, 2^11 - 1] 即 [0, 2047],
        // 之所以要减去 1023 是为了能够表示负指数,最终指数的取值范围为 [-1023, 1024]
        //
        // 当 e 的值为 0 或者 2047 时, 具有特殊含义:
        //   1. 0 < e < 2047, f = 任意值, 表示 (-1)^s * 1.f * 2^(e - 1023)
        //   2. e = 0,        f = 0,     表示 (-1)^s * 0
        //   3. e = 0,        f > 0,     表示 (-1)^s * 0.f * 2^(e - 1022)
        //   4. e = 2047,     f = 0,     表示 (-1)^s * Infinity
        //   5. e = 2047,     f > 0,     表示 NaN
      })();

      (function () {
        // 不是所有的十进制小数, 都可以被精确地表示成二进制小数,
        // 比如 0.1 就不能被精确地表示成某个二进制小数,
        // 主要的原因是, 二进制小数的分母必须是 2 的幂,
        // 而 0.1 = 1/10, 分母 10 不能表示成 2 的幂
        //
        // 反过来, 所有的二进制小数, 都可以被精确地转换成某个十进制小数
      })();

      (function () {
        // 分数部分占 52 位, 它能表示的最大值为 52个1,
        // 也就是说 1.f 所能表示的最大值为 1.<52个1>, 配合上指数部分, 也就是 53个1 (2^53 - 1),
        // 也就是说 [0, 2^53 - 1] 之间的所有整数都可以正确表示,
        // 要想表示超过这个范围的整数, 就必须增加指数部分,
        // 这时候表示的整数就不是连续的, 而是离散的,
        // 因此 JS 定义了一个常量 `Number.MAX_SAFE_INTEGER`, 表示可以安全表示的最大整数, 它的值就是 2^53 - 1
        // 同时 JS 定义了一个常量 `Number.MAX_VALUE`, 表示可以表示的最大整数(e = 2046, f=<52个1>)

        console.assert(Number.MAX_SAFE_INTEGER === 2 ** 53 - 1);
        console.assert(Number.MAX_VALUE === Number.MAX_SAFE_INTEGER * 2 ** (1023 - 52));
      })();
    </script>
  </head>

  <body></body>
</html>
